# 📄 요구사항 분석 문서

## 📌 프로젝트 개요

-   **프로젝트명:** e-커머스 상품 주문 서비스
-   **개발기간:** 2025.05.31 \~ 2025.06.20
-   **목표:** 사용자 잔액 충전 및 상품 주문 시스템 구현
-   **주요 기술:** NestJS, TypeORM, Jest, Swagger
-   **핵심 고려사항:** 동시성 처리, 트랜잭션 일관성, 실시간 통계 반영

---

## ✅ 문제 정의

사용자들이 상품을 주문할 수 있는 단순한 이커머스 서비스를 제공하고자 한다. 해당 서비스에서는 **선충전 방식의 잔액**, **상품 재고**, **선착순 쿠폰**, **실시간 인기 상품 통계** 등 다양한 기능이 함께 운영되며, 다수의 사용자 동시 접근이 고려되어야 한다.

---

## ✅ 기능적 요구사항 (Functional Requirements)

### 1. 잔액 충전 및 조회 API

-   사용자 ID와 충전 금액을 입력받아 잔액을 증가시킨다.
-   사용자 ID를 기반으로 현재 잔액을 조회할 수 있다.

### 2. 상품 조회 API

-   전체 상품 목록(ID, 이름, 가격, 재고 수량)을 반환한다.
-   최신 재고 상태를 보장해야 한다.

### 3. 주문 / 결제 API

-   사용자 ID와 상품 목록(ID, 수량)을 입력받아 주문을 수행한다.
-   잔액 부족, 재고 부족 시 주문 실패 처리해야 한다.
-   주문 성공 시 잔액과 재고를 동시에 감소시켜야 한다.
-   주문 정보는 외부 데이터 플랫폼으로 전송되어야 한다 (Mock 가능).

### 4. 선착순 쿠폰 API

-   선착순으로 쿠폰 발급 (수량 제한 존재)
-   쿠폰 발급 API 및 사용자 보유 쿠폰 조회 API 제공
-   주문 시 유효한 쿠폰을 적용해 총 금액에서 할인

### 5. 인기 상품 조회 API

-   최근 3일간의 주문 데이터를 기준으로 가장 많이 판매된 상품 5개를 반환한다.
-   효율적인 통계 처리를 위해 조회 성능을 고려해야 함

---

## ✅ 비기능적 요구사항 (Non-functional Requirements)

| 항목             | 요구사항                                                 |
| ---------------- | -------------------------------------------------------- |
| 동시성 처리      | 주문/충전/쿠폰 등 모든 기능에서 Race Condition 방지 필요 |
| 재고/잔액 일관성 | DB 트랜잭션 또는 Lock 기반 처리 필요                     |
| 확장성           | 멀티 인스턴스 환경에서의 정합성 보장                     |
| 테스트           | 각 기능별 단위 테스트 필수, 통합 테스트 Nice to Have     |
| 문서화           | Swagger 기반 API 명세 문서 제공                          |
| 통계             | 주문 데이터 기반 집계 기능 필요 (캐싱, 배치 고려 가능)   |

---

## ✅ 우선순위 정리

| 우선순위 | 기능                    | 비고                       |
| -------- | ----------------------- | -------------------------- |
| 1순위    | 잔액 API, 상품 조회 API | 핵심 기반 기능             |
| 2순위    | 주문/결제 API           | 비즈니스 로직 중심 기능    |
| 3순위    | 쿠폰 API                | 동시성/한정 자원 처리 예제 |
| 4순위    | 인기 상품 조회          | 통계 및 집계 기능 테스트   |

---

## ✅ 주요 고려사항 정리

-   Redis 또는 DB Lock을 통한 동시성 처리 전략
-   트랜잭션 내 로직 분리 및 실패 시 Rollback 처리
-   외부 데이터 전송 시 비동기 처리 또는 Queue 사용 고려
-   Mock API 또는 Swagger 기반 문서 우선 작성으로 프론트 협업 효율성 강화

---

## ✅ 참고 자료

-   [Milestone 문서](./milestone.md)
-   [API 명세 문서 (작성 예정)](./03-api-spec.md)
-   [ERD 및 모델링 (작성 예정)](./02-erd.md)
